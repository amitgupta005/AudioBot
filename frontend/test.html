<!DOCTYPE html>
<html>

<head>
    <title>AudioBot Simple Test</title>
    <style>
        body {
            font-family: monospace;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
        }

        #log {
            height: 400px;
            border: 1px solid #ccc;
            overflow-y: scroll;
            padding: 10px;
            margin-bottom: 10px;
            background: #f0f0f0;
        }

        .message {
            margin: 5px 0;
            border-bottom: 1px solid #ddd;
            padding: 5px 0;
        }

        .sent {
            color: blue;
        }

        .received {
            color: green;
        }

        .error {
            color: red;
        }

        .system {
            color: gray;
            font-style: italic;
        }

        #input-container {
            display: flex;
            gap: 10px;
        }

        input {
            flex-grow: 1;
            padding: 10px;
        }

        button {
            padding: 10px 20px;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <h2>AudioBot WebSocket Test</h2>
    <div id="status">Status: <span id="status-text" style="color:orange">Connecting...</span></div>
    <div id="log"></div>
    <div id="input-container">
        <input type="text" id="msg" placeholder="Type a message (e.g., 'Hello' or 'What time is it?')" autofocus>
        <button onclick="send()">Send</button>
    </div>

    <script>
        const logDiv = document.getElementById('log');
        const statusText = document.getElementById('status-text');
        const msgInput = document.getElementById('msg');
        let ws = null;

        function connect() {
            ws = new WebSocket('ws://localhost:8000/ws');

            ws.onopen = function () {
                statusText.innerText = 'Connected';
                statusText.style.color = 'green';
                log('System', 'Connected to WebSocket server', 'system');
            };

            ws.onmessage = function (e) {
                log('Received', e.data, 'received');
            };

            ws.onerror = function (e) {
                statusText.innerText = 'Error';
                statusText.style.color = 'red';
                log('Error', 'WebSocket error occurred', 'error');
            };

            ws.onclose = function () {
                statusText.innerText = 'Disconnected';
                statusText.style.color = 'red';
                log('System', 'Connection closed', 'system');
            };
        }

        function send() {
            const text = msgInput.value;
            if (!text) return;
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                log('Error', 'Not connected', 'error');
                return;
            }
            ws.send(text);
            log('Sent', text, 'sent');
            msgInput.value = '';
        }

        function log(type, msg, className) {
            const div = document.createElement('div');
            div.className = 'message ' + className;
            div.innerHTML = `<strong>${type}:</strong> ${msg}`;
            logDiv.appendChild(div);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        msgInput.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') send();
        });

        // Connect immediately
        connect();
    </script>
</body>

</html>